var A=Object.defineProperty;var S=(t,e,a)=>e in t?A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var x=(t,e,a)=>(S(t,typeof e!="symbol"?e+"":e,a),a);import{a as g}from"./index-49711d8f.js";window.ajaxProcess=!1;window.queue={list:[],start:function(){if(queue.list.length){var t=queue.list.splice(0,1),t=t[0];ajax(t.obj,t.callback,t.form)}}};window.delAjaxPreloader=t=>{let e=t.find('[type="submit"]:eq(-1)');e.length==0&&(e=t.find("button:eq(-1)")),e.length&&e.attr("text")&&(e.html(e.attr("text")),e.removeAttr("style"))};window.setAjaxPreloader=(t,e)=>{let a=t.find('[type="submit"]:eq(-1)');a.length==0&&(a=t.find("button:eq(-1)")),a.length&&e&&(a.attr("text")||a.attr("text",a.html()),a.css("min-width",parseFloat(a.css("width"))+"px").html(e))};window.ajax=function(t,e,a){if(ajaxProcess)return typeof t=="object"&&t.queue&&queue.list.push({obj:t,callback:e,form:a}),!1;ajaxProcess=!0;var r={headers:{}},n=localStorage.getItem("token"),s='<div class="spinner-border spinner-border-sm" role="status"><span class="sr-only"></span></div>';n&&(r.headers.Authorization="Bearer "+n),typeof t=="object"?(r=Object.assign(r,t),typeof t.preloader_html<"u"&&(s=t.preloader_html),t.preloader&&t.preloader.css("height",parseFloat(t.preloader.css("height"))+"px").html(s),typeof t.data=="object"&&!t.data._token&&typeof csrf_token<"u"&&(t.data._token=csrf_token)):r.url=t,a&&setAjaxPreloader(a,s),$.ajax(r).always(function(l,o,f){a&&delAjaxPreloader(a),typeof t=="object"&&t.preloader&&t.preloader.removeAttr("style").html("");var d=!0;l&&(l=l.responseJSON?l.responseJSON:l,l&&l.errors&&(typeof validate<"u"&&(typeof t.validate<"u"&&t.validate!==!1||typeof t.validate>"u")&&validate.errors(l.errors,a),d=!1)),ajaxProcess=!1,e&&e(l,d),setTimeout(queue.start,0)})};$(document).on("ajax.update",function(){ajax(location.href,function(t){$("[ajax-elem]",t).each(function(e){$("[ajax-elem]:eq("+e+")").before($(this).clone()).remove()}),$(document).trigger("ajax.update.success")})});window.scroller={duration:600,setTimeout:!1,init:()=>{location.hash?scroller.onloadScroll(t=>{t?$(window).trigger("scroller.animate.end"):setTimeout(()=>{$(window).trigger("scroller.animate.end")},scroller.duration)}):setTimeout(()=>{$(window).trigger("scroller.animate.end")},scroller.duration),$(document).on("click","[scroll-top]",scroller.toTop).on("click",'[href*="#"], [data-toggle="scroll"]',function(t){if(scroller.allowed($(this))){var e=scroller.elemHash($(this)),a=scroller.elem(e);if(a&&a.length)return t.preventDefault(),scroller.to(a,()=>{scroller.setLocationHash(e,a)}),!1}})},setLocationHash:(t,e)=>{scroller.replaceAttr(e),location.hash=t,scroller.replaceAttr(e)},replaceAttr:t=>{t.attr("name")||t.attr("id")?(t.attr("name")&&t.attr("data-name",t.attr("name")).removeAttr("name"),t.attr("id")&&t.attr("data-id",t.attr("id")).removeAttr("id")):(t.attr("data-id")&&t.attr("id",t.attr("data-id")).removeAttr("data-id"),t.attr("data-name")&&t.attr("name",t.attr("data-name")).removeAttr("data-name"))},onloadScroll:t=>{var e=scroller.hash(decodeURIComponent(location.href)),a=scroller.elem(e);a&&a.length?scroller.to(a,t):t&&t(!1)},allowed:t=>{let e=["collapse","tab","pill"].indexOf(t.attr("data-toggle"))==-1;return t.attr("data-scroll-disabled")&&(e=!1),e},hash:t=>{let e=t.split("#");return e=e[e.length-1],e=e.split("?"),e=e[0],e=e.replace(/[^a-zA-Z0-9_-]+/g,""),e},elemHash:t=>scroller.hash(t.attr("href")?t.attr("href"):t.attr("data-target")),elem:t=>{if(t&&t.indexOf("://")==-1){var e=$("*").is("#"+t);return e&&($("#"+t).css("display")=="none"||$("#"+t).hasClass("modal"))&&!$("#"+t).hasClass("tab-pane")?!1:e?$("#"+t):$("a").is('[name="'+t+'"]')?$('a[name="'+t+'"]'):!1}return!1},getScrollTop:(t,e)=>{let a=t.offset().top,r=t.attr("data-scroll-center")!=null;if($("html").attr("style")&&$("html").attr("style").indexOf("zoom")>-1){var n=parseFloat($("html").css("zoom"));a=($(t).offset().top-$(".header").height())*n+$(window).scrollTop()*(1-n)}if(r){let s=$(window).height(),l=t.height();s>l&&(a-=(s-l)/2)}else{let s=0;$("[scroll-fixed]").each(function(){$(this).css("display")!="none"&&(s+=parseFloat($(this).css("height")))}),s&&(a-=s)}return e&&(a+=e),t.attr("data-top")&&(a+=parseInt(t.attr("data-top"))),a},animate:(t,e,a)=>{typeof ZoneObject<"u"&&ZoneObject!=null&&ZoneObject.off();let r=scroller.getScrollTop(t,e);$("html, body").stop().animate({scrollTop:r},scroller.duration),scroller.setTimeout&&clearTimeout(scroller.setTimeout),scroller.setTimeout=setTimeout(()=>{t.trigger("scroll-complete"),typeof ZoneObject<"u"&&ZoneObject!=null&&ZoneObject.on(),a&&a(!0)},scroller.duration*1.5)},to:(t,e,a)=>{if(t&&t.length){if($(".modal-open").length){if($(".modal").find(t).length)return!1;$(".modal-open").removeClass("modal-open")}t.trigger("scroll-start"),$('[data-toggle="dropdown"]').length&&typeof $.fn.dropdown<"u"&&$('[data-toggle="dropdown"][aria-expanded="true"]').trigger("click"),setTimeout(()=>{scroller.animate(t,a,e)},t.attr("data-timeout")?parseFloat(t.attr("data-timeout")):0)}else e&&e(!1)},toTop:()=>{scroller.to($("body"))}};$(scroller.init);window.validate={initOn:!1,name:!1,form:!1,options:{},list:{},valid_text:{required:"Заполните это поле",max:{numeric:"Не может быть более :max.",file:"Размер файла превышает :max килобайт(а).",string:"Сократите текст",array:"Количество элементов не может превышать :max."},min:{numeric:"Должно быть не менее :min.",file:"Размер файла должен быть не менее :min килобайт(а).",string:"Количество символов должно быть не менее :min",array:"Количество элементов должно быть не менее :min."},email:"Введите корректный электронный адрес",confirmed:"Не совпадает с подтверждением",mimes:"Неподдерживаемый тип файла",url:"Введите корректную ссылку",domain:"Введите корректный домен",source:"Введите корректную ссылку",urlLight:"Введите корректную ссылку"},valid:{source:t=>{let e=t.split("/"),a=$.trim(e[e.length-1]);return t.indexOf(".")>-1&&t.indexOf("/")>-1&&a},urlLight:t=>t.indexOf(".")>-1,url:t=>{try{return new URL(t[i]),t[i].indexOf("http://")>-1||t[i].indexOf("https://")>-1}catch{return!1}},domain:t=>t.match(new RegExp(/^((?:(?:(?:\w[\.\-\+]?)*)\w)+)((?:(?:(?:\w[\.\-\+]?){0,62})\w)+)\.(\w{2,6})$/)),required:function(t){return t},email:function(t){var e=/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i;return e.exec(t)},max:function(t,e,a){return parseFloat(a)>=validate.helper.length(e)},min:function(t,e,a){return parseFloat(a)<=validate.helper.length(e)},confirmed:function(t){return t==validate.helper.value(validate.form.find('[name="'+validate.name.replace("_confirmation","")+'"]'))},mimes:function(t,e,a){var r=validate.helper.file.types(e),n=!1;return $.each(r,function(s,l){if(a.indexOf(l)==-1)return n=l,!1}),n==!1},getText:function(t,e,a,r,n){var s=validate.valid_text[t];return typeof s=="object"&&(s=s[r]),typeof a=="object"&&a!=null&&a[n+"."+t]&&(s=a[n+"."+t]),s.replace(":"+t,e[0])}},helper:{type:function(t){var e="string",a=t.attr("data-type")?t.attr("data-type"):t.attr("type");return a=="file"&&(e="file"),a=="number"&&(e="numeric"),a=="array"&&(e="array"),e},file:{size:function(t){var e=0;return typeof t[0].files<"u"&&$.each(t[0].files,function(a,r){e+=r.size}),e&&parseFloat((e/1024).toFixed(3))},types:function(t){var e=[];return typeof t[0].files<"u"&&$.each(t[0].files,function(a,r){var n=r.name.split(".");e.push(n[n.length-1])}),e}},length:function(t){var e=!1;return t.attr("type")=="file"?e=validate.helper.file.size(t):e=$.trim(t.val()).replace(/\n/g,`
\r`).length,e},value:function(t){return t.attr("type")=="radio"&&(t=validate.form.find('[name="'+t.attr("name")+'"]:checked')),$.trim(t.val())},formGroup:function(t){return t.closest("[data-valid-group], .form-group")},groupLabel:function(t){var e=validate.helper.formGroup(t);if(e.length){var a=e.find("[data-valid-label]:eq(0)");return a.length?a:e.find("label:eq(0)")}return $()}},checkTimeout:!1,check:function(t,e,a,r){typeof a!="object"&&a===!0&&(a=!1,r=!0);var n={};return $.each(e,function(s,d){validate.form=t,validate.name=s;var o=t.find('[name="'+s+'"]'),f=validate.helper.type(o),d=d.split("|"),v=$.trim(validate.helper.value(o));if(d.indexOf("required")==-1&&!v)return!0;let u=null;typeof validate.options.delimiter=="object"&&validate.options.delimiter!=null&&validate.options.delimiter[validate.name]&&(u=v.split(validate.options.delimiter[validate.name])),u=Array.isArray(u)?u:[v];for(let m=0;m<u.length;m++)d.forEach(h=>{var p=h.split(":"),h=p.splice(0,1),_=p.length?validate.valid[h]($.trim(u[m]),o,p[0]):validate.valid[h]($.trim(u[m]),o);if(!_){n[s]||(n[s]=[]);var j=validate.valid.getText(h,p,a,f,s);j&&n[s].push(j)}})}),r&&(validate.checkTimeout&&clearTimeout(validate.checkTimeout),validate.checkTimeout=setTimeout(function(){validate.errors(n,t)},100)),n},notSeen:function(t){var e=$(window).scrollTop(),a=$(window).height(),r=$(t),n=[];return r.each(function(){var s=$(this),l=s.is(":visible");l||(s.before("<div data-tmp-visible></div>"),s=$("[data-tmp-visible]"));let o=s.offset();e<=o.top&&s.height()+o.top<e+a||n.push(this),l||s.remove()}),$(n)},init:function(){validate.initOn=!0,$(document).on("change",'[name][type="radio"], [name][type="checkbox"]',function(){let t=$(this).attr("name");$('[name="'+t+'"].is-invalid').length&&validate.error_remove($('[name="'+t+'"].is-invalid'))}).on("keyup change",".is-invalid, .is-invalid *, .selectized",function(){let t=$(this).attr("type");t&&["radio","checkbox"].indexOf(t)==-1&&validate.error_remove($(this))})},error:function(t,e,a){validate.initOn||validate.init(),a=typeof a<"u"?a:$("body");var r=a.find('[name="'+t+'"]:eq(0)').length?a.find('[name="'+t+'"]:eq(0)'):a.find('[name^="'+t+'["]:eq(0)');if(!r.length&&t.indexOf(".")>-1){let s=t.split("."),l=s.map((o,f)=>f?"["+o+"]":o);l=l.join(""),r=a.find('[name="'+l+']"]:eq(0)'),$('[data-valid-input="'+l+'"]').length&&(r=$('[data-valid-input="'+l+'"]'))}else $('[data-valid-input="'+t+'"]').length?r=$('[data-valid-input="'+t+'"]'):$('[data-valid-input^="'+t+'["]').length&&(r=$('[data-valid-input^="'+t+'["]'));if(r.length){$('[data-error-input="'+t+'"]').remove(),r.addClass("is-invalid").after('<div data-error-input="'+t+'" class="invalid-feedback">'+(typeof e=="object"?e[0]:e)+"</div>");var n=validate.helper.groupLabel(r);return n.length&&n.addClass("invalid-label"),!0}else return!1},errorInputElem:t=>{let e=$('[data-error-input="'+t.attr("name")+'"]');return e.length==0&&(e=t.next("[data-error-input]"),e.length==0&&(e=t.parents("[data-valid-group]").find("[data-error-input]"))),e},error_remove:function(t){t.removeClass("is-invalid");const e=validate.errorInputElem(t);e.parents(".is-invalid").removeClass("is-invalid");var a=validate.helper.formGroup(e);a.length&&a.find(".invalid-label").removeClass("invalid-label"),e.remove()},errors:function(t,e){validate.initOn||validate.init(),e=typeof e<"u"?e:$("body"),e.find(".is-invalid").each(function(){validate.error_remove($(this))});var a=[];$.each(t,function(r,n){validate.error(r,n,e)||a.push(n)}),a.length&&alert(a.join(", ")),validate.scrollToError(e)},dropdownShow:t=>{let e=t.parents("[aria-labelledby]");e.length&&$("#"+e.attr("aria-labelledby")).dropdown("show")},scrollToError:t=>{if(typeof scroller<"u"&&t.find(".is-invalid").length){let e=t.find(".is-invalid:eq(0)");validate.dropdownShow(e),validate.notSeen(e).length&&scroller.to(e,!1,-50)}},createTimeout:!1,create:(t,e,a)=>{$.each(e,(r,n)=>{$(document).on("input blur",t+' [name="'+r+'"]',()=>{let s={};s[r]=n,typeof a=="object"&&a!=null&&(validate.options=a),validate.checkTimeout&&clearTimeout(validate.checkTimeout),validate.checkTimeout=setTimeout(()=>{validate.check($(t),s,!0)},600)})})}};class C{constructor(e,a){this.options=typeof a=="object"&&a!=null?a:{afterSubmit:a,onChangeSubmit:!1},!this.options.modalConfirm&&$(e).attr("data-modal-confirm")&&(this.options.modalConfirm=$(e).attr("data-modal-confirm")),$(e).attr("data-onchange-submit")=="true"&&(this.options.onChangeSubmit=!0),typeof this.options.childForms>"u"&&(this.options.childForms=[],$(e).find("[data-child-form]").each((r,n)=>{this.options.childForms.push({elem:$(n),validUrl:$(n).attr("data-valid-url"),actionUrl:$(n).attr("action"),target:$(n).attr("data-target")})})),this.selector=e,this.isEditMode=!1,this.modalConfirmEventsInit=!1,this.events(),$("body").append('<a id="ajax_form_tmp_url" style="display: none;" target="_blank"></a>')}sendAfterRedirect(e){e.attr("data-send-after-redirect")&&(location.href=e.attr("data-send-after-redirect"))}submitEvent(e){const a=e.attr("data-submit-event");a&&$.ajax({url:a,type:"post",data:new FormData(e[0]),processData:!1,contentType:!1})}getActionId(){let e=$(this.selector).attr("action");if(e&&e.indexOf("/")>-1){let a=e.split("/");return a[a.length-1]}return null}itemsHtmlUpdate(e){let a=this.getActionId();if(typeof items<"u"&&a){let r=$(this.selector).attr("items-form");r&&items.htmlUpdate(r,$("[items-html-"+r+'="'+a+'"]'),e)}}modalConfirm(){return this.options.modalConfirm?$(this.options.modalConfirm):$(this.selector).attr("data-modal-confirm")?$($(this.selector).attr("data-modal-confirm")):$()}modalConfirmEvents(){this.modalConfirmEventsInit==!1&&(this.modalConfirmEventsInit=!0,this.modalConfirm().find("form").on("submit",e=>{e.preventDefault(),this.submit($(this.selector))}))}events(){$(document).on("click","[data-ajax-form-reset]",e=>{this.reset($(e.currentTarget).parents("[data-ajax-form]"))}).on("change",this.selector+" [name]",e=>{this.onChange(e)}).on("change","[data-onchange-submit] [name]",()=>{this.options.onChangeSubmit&&$(this.selector).trigger("submit")}).on("submit",this.selector,e=>{e.preventDefault();let a=$(e.currentTarget),r=a.find('[type="submit"]');if(r.attr("class")&&r.attr("class").indexOf("deactive")>-1)return!1;if((a.attr("data-edit-mode")=="true"||this.options.editMode)&&this.isEditMode==!1)return this.editModeOn(a),!1;this.modalConfirm().length?(this.options.beforeModalConfirm&&this.options.beforeModalConfirm(),this.modalConfirm().modal("show"),this.modalConfirmEvents()):this.submit(a)})}sendGoal(e,a){e.attr("data-goal-id")&&typeof ym<"u"&&ym(e.attr("data-goal-id"),"reachGoal",a)}onChange(e){let a=$(e.currentTarget).parents("form");a.attr("data-goal-start-fill")&&!a.attr("data-goal-start-fill-send")&&(a.attr("data-goal-start-fill-send","true"),this.sendGoal(a,a.attr("data-goal-start-fill")))}editModeOn(e){this.isEditMode=!0,e.find("[disabled]").each((r,n)=>{n.getAttribute("data-edit-mode-disabled")||(n.removeAttribute("disabled"),n.setAttribute("data-edit-mode-enabled","true"))});let a=e.find('[name][type="text"]:eq(0)');a.length==0&&(a=e.find("textarea[name]:eq(0)")),a.length&&(a=a[0],a.focus(),a.setSelectionRange(a.value.length,a.value.length)),e.find("button").html("Сохранить")}editModeOff(e){this.isEditMode=!1,e.find("[data-edit-mode-enabled]").each((a,r)=>{r.disabled="disabled"}),e.find("button").html("Редактировать")}scrollToError(){typeof scroller<"u"&&$(".is-invalid").length&&validate.notSeen($(".is-invalid:eq(0)")).length&&scroller.to($(".is-invalid:eq(0)"),!1,-50)}isErrors(e){return e.find("[data-error-input]").length}reset(e){e.trigger("reset"),this.htmlReset(e)}elementsShowHide(e,a){let r=e.attr("data-ajax-form");const n=(s,l)=>{let o=parseFloat(s.attr("data-animate-duration"));o?(s.removeClass("animate-finish-show animate-finish-hide"),l||s.addClass("animate-process-hide"),setTimeout(()=>{l?(s.show(),s.addClass("animate-process-show"),setTimeout(()=>{s.removeClass("animate-process-show"),s.addClass("animate-finish-show")},o)):(s.removeClass("animate-process-hide"),s.addClass("animate-finish-hide"),s.hide())},o)):l?s.show():s.hide()};r&&($('[data-ajax-form-show="'+r+'"]').each((s,l)=>{n($(l),!a)}),$('[data-ajax-form-hide="'+r+'"]').each((s,l)=>{n($(l),a)})),e.find("[data-ajax-form-show]").each((s,l)=>{n($(l),!a)}),e.find("[data-ajax-form-hide]").each((s,l)=>{n($(l),a)})}htmlReset(e){e.removeClass("success"),this.elementsShowHide(e,!0),e.find("progress").val("0").hide(),e.find(".progress").hide().find(".progress-bar").css("width","0")}formData(e){let a={url:e.attr("action")?e.attr("action"):location.href,type:e.attr("method")?e.attr("method"):"post",data:new FormData(e[0]),processData:!1,contentType:!1};if(typeof ajaxFormPreloader<"u"&&(a.preloader_html=ajaxFormPreloader),this.modalConfirm().length){let r=new FormData(this.modalConfirm().find("form")[0]);for(let n of r.entries())a.data.append(n[0],n[1])}return a}validChldrens(e){if(this.options.childForms.length){setAjaxPreloader($(this.selector),'<div class="spinner-border spinner-border-sm" role="status"><span class="sr-only"></span></div>');let a=[],r=!1,n=!1,s=!1,l=!1;this.options.childForms.forEach(o=>{let f={url:o.validUrl,type:"post",data:new FormData(o.elem[0]),processData:!1,contentType:!1};f.success=d=>{d.error?r=d.error:d.errors?n=d.errors:a.push(d),o.callback&&(l=!0,o.callback(d))},f.error=()=>{s=!0,o.callback&&(l=!0,o.callback({serverError:!0}))},$.ajax(f)}),this.validChldrensInterval=setInterval(()=>{n!==!1||r!==!1||s!==!1?(clearInterval(this.validChldrensInterval),e({isCallback:l,error:r,errors:n,serverError:s}),delAjaxPreloader($(this.selector))):a.length==this.options.childForms.length&&(clearInterval(this.validChldrensInterval),e(!0))},1e3)}else e(!0)}submitChildrens(e,a){if(this.options.childForms.length&&(e.redirect||e.success)){setAjaxPreloader($(this.selector),'<div class="spinner-border spinner-border-sm" role="status"><span class="sr-only"></span></div>');let r=[];this.options.childForms.forEach(n=>{$.ajax({url:n.actionUrl,type:"post",data:new FormData(n.elem[0]),processData:!1,contentType:!1}).always(()=>{r.push(!0)})}),this.validChldrensInterval=setInterval(()=>{r.length==this.options.childForms.length&&(clearInterval(this.validChldrensInterval),a())},1e3)}else a()}redirect(e){$(this.selector).attr("data-redirect-target")=="_blank"?($("#ajax_form_tmp_url").attr("href",e),$("#ajax_form_tmp_url")[0].click()):location.href=e}resetChildrens(e){this.options.childForms.length&&(e.redirect||e.success)&&this.options.childForms.forEach(a=>{a.elem.trigger("reset").trigger("ajax-response-success")})}submit(e){this.modalConfirm().length&&this.modalConfirm().modal("hide");const a=()=>{if(e.attr("data-ajax-process"))return!1;e.attr("data-ajax-process",!0),this.submitEvent(e),this.validChldrens(r=>{if(r===!0)if(this.isErrors(e))e.removeAttr("data-ajax-process"),delAjaxPreloader(e),this.scrollToError();else{let n=this.formData(e);(e.find("progress").length||e.find(".progress").length>0)&&(n.xhr=()=>{let l=new window.XMLHttpRequest;return l.upload.addEventListener("progress",function(o){if(o.lengthComputable){let f=o.loaded/o.total,d=Math.round(f*100);e.find("progress").length>0&&e.find("progress").val(d).show(),e.find(".progress").length>0&&(e.find(".progress").show(),e.find(".progress-bar").html(d).css("width",d+"%").attr("aria-valuenow",d))}},!1),l}),ajax(n,l=>{if(this.options.afterSubmit&&this.options.afterSubmit(l),typeof l!="object"&&(n.url.indexOf("login")>-1||n.url.indexOf("register")>-1||n.url.indexOf("forgot")>-1||n.url.indexOf("reset-password")>-1))var l={success:!0};this.submitChildrens(l,()=>{this.sendAfterRedirect(e),e.removeAttr("data-ajax-process"),delAjaxPreloader(e),l!=null&&l.data&&(window.AjaxFormData=l.data),l.redirect?(e.trigger("ajax-response-redirect"),e.attr("data-goal-success")?(this.sendGoal(e,e.attr("data-goal-success")),setTimeout(()=>{this.redirect(l.redirect)},1e3)):this.redirect(l.redirect)):l.success?(e.attr("data-goal-success")&&this.sendGoal(e,e.attr("data-goal-success")),e.trigger("ajax-response-success"),typeof modalNotify<"u"&&typeof l.success=="string"&&(l.text||(l.text=l.success),modalNotify.create(l)),e.attr("data-ajax-form-reload")&&location.reload(),e.attr("data-ajax-form-redirect")&&this.redirect(e.attr("data-ajax-form-redirect")),e.addClass("success"),e.find("[data-ajax-form-reset]").length==0&&e.attr("data-reset")!=="false"&&this.reset(e),this.elementsShowHide(e),(e.attr("data-edit-mode")=="true"||this.options.editMode)&&this.isEditMode==!0&&this.editModeOff(e),l&&typeof l.data<"u"&&this.itemsHtmlUpdate(l.data)):this.htmlReset(e),this.resetChildrens(l),e.trigger("ajax-response")})},e)}else e.removeAttr("data-ajax-process"),typeof r.isCallback==!1&&(r.error!==!1?alert(r.error):r.errors!==!1?alert(JSON.stringify(r.errors)):alert("Оошибка сервера, попробуйте позже"))})};this.options.beforeSubmit?this.options.beforeSubmit(r=>{r&&a()}):a()}}window.dataAjaxFormEach=()=>{$("[data-ajax-form]").each((t,e)=>{if(!$(e).attr("data-ajax-form-init")){let a=$(e).attr("data-ajax-form");a?new C('[data-ajax-form="'+a+'"]'):new C("[data-ajax-form]:eq("+t+")"),$(e).attr("data-ajax-form-init",!0)}})};$(()=>{window.dataAjaxFormEach()});class E{constructor(e){x(this,"tooltipShow",(e,a)=>{e.tooltip({title:"Скопировано",placement:e.attr("data-placement")?e.attr("data-placement"):"top",trigger:"manual"}),e.tooltip("show"),setTimeout(()=>{e.one("hidden.bs.tooltip",function(){e.tooltip("dispose")}),e.tooltip("hide"),a&&a()},3e3)});x(this,"click",e=>{let a=$(e.currentTarget),r=a.attr("data-input-copy"),n=r?$(r):a;if(r=="prev"?n=a.prev():r=="next"&&(n=a.next()),$("body").append('<textarea id="tmpCopy">'+(n.attr("name")?n.val():n.text())+"</textarea>"),document.getElementById("tmpCopy").select(),document.execCommand("copy"),$("#tmpCopy").remove(),typeof $.fn.tooltip<"u")if(a.closest(".dropdown").length)this.tooltipShow(a.closest(".dropdown"));else if(a.attr("data-toggle")=="tooltip"){if(a.closest("#temp_tooltip").length==0){var s=$('<span id="temp_tooltip"/>').css("display","inline-block");a.wrap(s),a.tooltip("hide"),this.tooltipShow($("#temp_tooltip"),()=>{a.unwrap()})}}else this.tooltipShow(a)});$(document).on("click",e,this.click)}}new E("[data-input-copy]");window.items={onScrollAllEndTimeout:!1,ajaxProcess:{},updateTimeout:{},updates:{},model:{},update:function(t,e){if(typeof items.model[t]<"u"){var a=items.model[t],r=items.elem(a);a.url&&(items.updates[t]=!0,r.total.html("0"),r.list.hide().find("[items-html-"+a.name+"]").remove(),r.empty.hide(),r.preloader.show(),items.updateTimeout[t]&&clearTimeout(items.updateTimeout[t]),items.updateTimeout[t]=setTimeout(()=>{items.ajaxProcess[a.name]=!1,items.load(a,function(n){r.preloader.hide(),items.isNextData(a)?r.showMore.show():r.showMore.hide(),items.isLoopReverse(a)?items.model[a.name].loop_iteration=n.total:items.model[t].loop_iteration=1,items.print(a,n),items.updates[t]=!1},{data:e})},1e3))}},create:function(t){t.modal=t.modal?t.modal:null,t.modal!=null&&(t.modal.name=t.modal.name?t.modal.name:t.name,t.modal.outerHTML||(t.modal.outerHTML=$("[items-modal-"+t.modal.name+"]:eq(0)").length?$("[items-modal-"+t.modal.name+"]:eq(0)")[0].outerHTML:null),t.modal.selector||(t.modal.selector="[items-html-"+t.name+"]")),$("[items-list-"+t.name+"]").length&&(t.url||(t.url=$("[items-list-"+t.name+"]").attr("items-list-"+t.name)),t.glueUnions=typeof t.glueUnions<"u"?t.glueUnions:!1,t.scroll_elem=t.scroll_elem?t.scroll_elem:!1,t.prepend=t.prepend?t.prepend:!1,t.ajaxProcessChange=typeof t.ajaxProcessChange<"u"?t.ajaxProcessChange:!0,t.items=t.items?t.items:{current_page:1},t.loop_iteration=1,t.filterPushState=typeof t.filterPushState<"u"?t.filterPushState:!0,t.outerHTML=typeof t.outerHTML=="function"?t.outerHTML():items.model[t.name]?items.model[t.name].outerHTML:$("[items-html-"+t.name+"]:eq(0)")[0].outerHTML,$("[items-html-"+t.name+"]:eq(0)").parents("[items-list-"+t.name+"]").length==0&&$("[items-html-"+t.name+"]:eq(0)").remove(),t.data=typeof t.data<"u"&&t.data!=null?t.data:{},items.model[t.name]&&(t.clear=!0,t.onInit&&(t.onInit=null)),$("[items-scroll-window-"+t.name+"]").length&&(t.scroll_window=!0)),t.glueUnions&&items.glueUnionsElements($("[items-list-"+t.name+"] [html]")),items.model[t.name]=t,setTimeout(items.init,0)},glueUnionsElements:t=>{$.each(t,(e,a)=>{$(a).html(items.glueUnions($(a).html()))})},glueUnions:t=>(t&&typeof t=="string"&&(t=t.replace(/\s+(и|а|но|с|со|в|во|для|как|не|без|безо|близ|вместо|вне|до|за|из|изо|из-за|из-под|к|ко|кроме|меж|на|над|о|об|обо|от|ото|пред|передо|предо|по|под|подо|при|про|ради|сквозь|среди|у|через|чрез|это)\s+/gi," $1&nbsp;"),t=t.replace(/\s+(же|бы|ли)\s+/gi,"&nbsp;$1 ")),t),init:function(){var t=e=>{items.modal.openUrl(e),e.onInit&&e.onInit(),setTimeout(items.init,0)};$.each(items.model,function(e,a){if(!a.init){items.model[e].init=!0,a.clear&&items.clear(a),(a.scroll||a.scroll_window)&&items.events.scroll(a),items.events.update(a),items.events.showMore(a),items.events.modal(a),items.events.filter(a);var r=items.elem(a);return a.first_load&&a.url?(r.empty.hide(),r.preloader.show(),items.load(a,function(n){n.current_page!=n.last_page&&r.showMore.show(),r.preloader.hide(),items.isLoopReverse(a)?items.model[a.name].loop_iteration=n.total:items.model[e].loop_iteration=1,items.print(a,n),t(a)})):(a.items&&a.items.data&&items.print(a,a.items),t(a)),!1}})},URLParam:t=>{var e=new RegExp("[?&]"+t+"=([^&#]*)").exec(window.location.href);return e==null?null:decodeURI(e[1])||0},modal:{close:()=>{history.pushState(null,null,location.pathname)},open:(t,e)=>{t.modal.data(e,function(a){a.id&&t.modal.pushState?history.pushState(null,null,location.pathname+"?"+t.name+"="+a.id):history.pushState(null,null,location.pathname);var r=$(t.modal.outerHTML);r=items.dataInHtml(r,a,t),typeof t.modal.html=="function"&&(r=t.modal.html(r,a)),r=items.isset(r,a),$("[items-modal-"+t.modal.name+"]").remove(),$("body").append(r),typeof t.modal.onRender=="function"&&t.modal.onRender(a),$("[items-modal-"+t.modal.name+"]").modal("show")})},openUrl:t=>{t.modal&&t.modal.pushState&&location.href.indexOf(t.name+"=")>-1&&items.modal.open(t,items.URLParam(t.name))}},clear:function(t){var e=items.elem(t);e.list.find("[items-html-"+t.name+"]").remove(),e.preloader.hide(),e.empty.hide(),e.list.hide(),e.isset.hide(),e.list.off("scroll"),e.list.off("update"),e.showMore.off("click")},isNextData:function(t){return t.items.current_page<t.items.last_page||t.items.last_page==null},loadNextData:function(t,e){if(t=items.model[t.name],!items.ajaxProcess[t.name]&&!items.updates[t.name]){var a=items.elem(t);a.preloader.show(),items.load(t,function(r){a.preloader.hide(),items.isNextData(t)||a.showMore.hide();let n=r.data?Object.keys(r.data).length:0;n?(items.print(t,r),e&&e(n)):e&&e(0)},{ajaxProcessTimeout:1e3,page:t.items.current_page+1})}else e&&e(!1)},onScrollAllEnd:t=>{typeof t.onScrollAllEnd=="function"&&t.onScrollAllEnd()},events:{modal:function(t){t.modal!=null&&$(document).on("click",t.modal.selector,e=>{let a=$(e.currentTarget).closest("[items-html-"+t.modal.name+"]").length?$(e.currentTarget).closest("[items-html-"+t.modal.name+"]").attr("items-html-"+t.modal.name):$(e.currentTarget).closest("[items-html-"+t.name+"]").length?$(e.currentTarget).closest("[items-html-"+t.name+"]").attr("items-html-"+t.name):null;items.modal.open(t,a)}).on("hide.bs.modal","[entry-modal]",()=>{items.modal.close()})},showMore:function(t){var e=items.elem(t);e.showMore.on("click",function(){items.isNextData(t)?items.loadNextData(t):items.onScrollAllEnd(t)})},update:function(t){var e=items.elem(t);e.list.on("update",function(){items.update(t.name)})},scroll:function(t){var e=items.elem(t),a=function(s){return s=="window"?$(window).scrollTop()<300:s.scrollTop()<300},r=function(s){return t.prepend?a(s):s=="window"?$(window).height()+$(window).scrollTop()>=e.list.height()-300:s.height()+s.scrollTop()>=s[0].scrollHeight-300},n=()=>{items.isNextData(t)?items.loadNextData(t):items.onScrollAllEnd(t)};t.scroll_window?$(window).on("scroll",function(){r("window")&&n()}):t.scroll_elem?t.scroll_elem.on("scroll",function(){r(t.scroll_elem)&&n()}):e.list.on("scroll",function(){r(e.list)&&n()})},filter:t=>{let e=items.elem(t),a=n=>{let s={};return n.serializeArray().forEach(o=>{o.value&&(typeof s[o.name]<"u"?(Array.isArray(s[o.name])||(s[o.name]=[s[o.name]]),s[o.name].push(o.value)):s[o.name]=o.value)}),s},r=(n,s)=>{let l=$(n.currentTarget),o=a(l.parents("[items-filter-"+t.name+"]")),f=$.param(o);if(s=="input"&&l.attr("data-on-input","true"),s=="change"&&l.attr("data-on-input"))return l.removeAttr("data-on-input"),!1;t.filterPushState&&history.pushState({},"",location.pathname+(f?"?"+f:"")),items.update(t.name,o)};e.filter.find("[name]").on("change",n=>{r(n,"change")}).on("input",n=>{r(n,"input")})}},elem:function(t){return{total:$("[items-total-"+t.name+"]"),preloader:$("[items-preloader-"+t.name+"]"),filter:$("[items-filter-"+t.name+"]"),empty:$("[items-empty-"+t.name+"]"),isset:$("[items-isset-"+t.name+"]"),issetOne:$("[items-isset-one-"+t.name+"]"),list:$("[items-list-"+t.name+"]"),showMore:$("[items-show-more-"+t.name+"]"),html:$(t.outerHTML),scroll:t.scroll_elem?t.scroll_elem:$("[items-list-"+t.name+"]")}},isLoopReverse:function(t){return typeof items.model[t.name].loop_iteration_reverse<"u"?items.model[t.name].loop_iteration_reverse:!1},load:function(t,e,a){if((typeof a!="object"||a==null)&&(a={}),!items.ajaxProcess[t.name]){items.ajaxProcess[t.name]=!0,t.onBeforeLoad&&t.onBeforeLoad();var r=items.elem(t),n=typeof t.data=="function"?t.data():t.data;typeof a.data=="object"&&a.data!=null&&(n=a.data),typeof n.paginate>"u"&&r.list.attr("items-paginate")&&(n.paginate=r.list.attr("items-paginate")),a.page&&(n.page=a.page),t.url.indexOf("ajax=true")==-1&&(t.url.indexOf("?")>-1?t.url+="&ajax=true":t.url+="?ajax=true"),ajax({url:t.url,data:n,queue:!0},function(s){items.model[t.name].items=s,t.ajaxProcessChange&&(a.ajaxProcessTimeout?setTimeout(function(){items.ajaxProcess[t.name]=!1},a.ajaxProcessTimeout):items.ajaxProcess[t.name]=!1),t.onAfterLoad&&t.onAfterLoad(s),e(s)})}},attr:function(t,e){if(t.attr("attr")){var a=t.attr("attr").split(":");t.attr(a[0].replace(/_/g,"-"),items.getDataValue(a[1],e))}},attrAppend:(t,e)=>{if(t.attr("attr-append")){let a=t.attr("attr-append").split(":"),r=a[0].replace(/_/g,"-"),n=items.getDataValue(a[1],e);t.attr(r,t.attr(r)+" "+n)}},getDataValue:function(t,e){for(var a=t.split("."),r=0;r<a.length&&(e=e[a[r]],!!e);r++);return e||null},dataInHtml:function(t,e,a){return e&&typeof e=="object"&&($.each(e,function(r,n){r.indexOf("[")==-1&&t.find("[html-"+r.replace(/_/g,"-")+"]").html(n)}),t.find("[attr-append]").each(function(){items.attrAppend($(this),e)}),items.attrAppend(t,e),t.find("[attr]").each(function(){items.attr($(this),e)}),items.attr(t,e),t.find("[html]").each(function(){var r=items.getDataValue($(this).attr("html"),e);r&&(typeof a<"u"&&a.glueUnions&&(r=items.glueUnions(r)),$(this).html(r),$(this).css("display")=="none"&&$(this).show())})),t},isset:function(t,e){return e&&typeof e=="object"&&t.find("[isset]").each(function(){var a=items.getDataValue($(this).attr("isset"),e);a?$(this).show():$(this).remove()}),t},html:function(t,e,a){var r=$(t.outerHTML);if(r.find('[html="loop_iteration"]').length&&(items.model[t.name].loop_iteration_reverse?(r.find('[html="loop_iteration"]').html(items.model[t.name].loop_iteration),items.model[t.name].loop_iteration--):(r.find('[html="loop_iteration"]').html(items.model[t.name].loop_iteration),items.model[t.name].loop_iteration++)),r=items.dataInHtml(r,e,t),typeof t.html=="function"&&(r=t.html(r,e,a)),r)return typeof e=="object"&&e!=null&&e.id&&r.attr("items-html-"+t.name,e.id),r=items.isset(r,e),r.show()},htmlUpdate:function(t,e,a){if(e.length){var r=items.model[t],n=items.html(r,a);e.after(n).remove()}},htmlAppend:function(t,e){var a=items.model[t],r=items.html(a,e),n=items.elem(a);n.list.append(r)},dataOrderBy:(t,e,a)=>{let r=items.model[t];return r.items&&r.items.data&&Object.keys(r.items.data).length?(items.model[t].items.data=r.items.data.sort((n,s)=>{if(a=="asc"){if(n[e]<s[e])return-1;if(n[e]>s[e])return 1}else if(a=="desc"){if(n[e]>s[e])return-1;if(n[e]<s[e])return 1}return 0}),!0):!1},orderBy:(t,e,a)=>{if(items.dataOrderBy(t,e,a)){let n=items.model[t];n.items&&n.items.data&&Object.keys(n.items.data).length&&(items.elem(n).list.html(""),items.isLoopReverse(n)?items.model[t].loop_iteration=n.items.total:items.model[t].loop_iteration=1,items.print(n,n.items))}},print:function(t,e){t.onBeforePrint&&t.onBeforePrint(e);var a=items.elem(t);if(e.total&&a.total.html(e.total),e.data&&Object.keys(e.data).length)if(a.list.show(),a.isset.show(),a.issetOne.show(),t.prepend){var r=a.scroll.scrollTop(),n=a.list.height();$.each(e.data,function(s,l){a.list.prepend(items.html(t,l,s))}),t.onBeforeScrollOriginal&&t.onBeforeScrollOriginal(e),a.scroll.scrollTop(r+(a.list.height()-n))}else $.each(e.data,function(s,l){a.list.append(items.html(t,l,s))});else a.empty.show(),a.list.hide(),a.isset.hide();t.onPrint&&t.onPrint(e)}};$(()=>{items.init(),items.glueUnionsElements($("[data-glue-unions]"))});class O{constructor(){this.actions={},this.isFirstFetch=!1}restart(){setTimeout(()=>{this.request()},5e3)}add(e){this.actions[e.controller+"_"+e.method]=e,this.isFirstFetch==!1&&(this.isFirstFetch=!0,this.request())}request(){if(Object.keys(this.actions).length>0){let e=Object.assign({},this.actions),a=Object.keys(e);this.actions={},$.post("/multirequest",{actions:e},r=>{a.forEach(n=>{typeof e[n].callback=="function"&&e[n].callback(r.results[n])}),this.restart()},"json").fail(()=>{a.forEach(r=>{typeof e[r].callback=="function"&&e[r].callback({error:"Ошибка соединения"})}),this.restart()})}else this.restart()}}"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js")});const P=t=>{for(var e="=".repeat((4-t.length%4)%4),a=(t+e).replace(/\-/g,"+").replace(/_/g,"/"),r=window.atob(a),n=new Uint8Array(r.length),s=0;s<r.length;++s)n[s]=r.charCodeAt(s);return n},F=t=>{const e=t.getKey("p256dh"),a=t.getKey("auth"),r=(PushManager.supportedContentEncodings||["aesgcm"])[0],n={endpoint:t.endpoint,public_key:e?btoa(String.fromCharCode.apply(null,new Uint8Array(e))):null,auth_token:a?btoa(String.fromCharCode.apply(null,new Uint8Array(a))):null,encoding:r};fetch("/web-push/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(s=>s.json()).then(s=>{console.log("Success:",s)}).catch(s=>{console.error("Error:",s)})},k="BE_6-U1W8Ykk8IhI6GbFooJjXp8YPYTzFBhdv77cqiy2h8Bhm0Cc6hXT1LaB3ogmeVVXr1f1bBBsjzjdFPkQbDk",q=()=>{navigator.serviceWorker.ready.then(t=>{t.pushManager.getSubscription().then(e=>{if(e)return e;const a=P(k);return t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:a})}).then(e=>{if(!e){alert("Error occured while subscribing");return}F(e)})})};let w=!1,y=!1,b=!1,T=!0;const I=t=>{t.timeOnPause||(t.timeOnPause=12e4),t.delayOnActive||(t.delayOnActive=1e3);const e=()=>{w=!0,t.onPause&&t.onPause()},a=()=>{w=!1,y&&clearTimeout(y),y=setTimeout(()=>{e()},t.timeOnPause)},r=()=>{w?t.onPlay&&t.onPlay():T&&(T=!1,t.onActive&&t.onActive(),setTimeout(()=>{T=!0},t.delayOnActive)),a()};document.addEventListener("click",r),document.addEventListener("mousemove",r),document.addEventListener("keydown",r),window.addEventListener("scroll",()=>{b&&clearTimeout(b),b=setTimeout(()=>{a(),t.onStopScroll&&t.onStopScroll()},1e3)}),window.onbeforeunload=()=>{t.onStop&&t.onStop()},window.onfocus=()=>{t.onShowTab&&t.onShowTab()},window.onblur=()=>{t.onHideTab&&t.onHideTab()},document.hasFocus()?t.onShowTab&&t.onShowTab():t.onHideTab&&t.onHideTab()},c={init:()=>{c.events(),c.renderInit()},events:()=>{$(document).on("click","[data-bookmark-add-id]",function(){const t=$(this).attr("data-bookmark-add-id");$(this).attr("data-method")=="add"?c.add(t):c.del(t)}).on("ajaxLoad",()=>{c.renderInit()})},renderInit:()=>{let t=[];$("[data-bookmark-add-id]").each(function(){if(!$(this).attr("data-method")){const e=$(this).attr("data-bookmark-add-id");t.indexOf(e)==-1&&t.push(e)}}),c.getStatus(t,e=>{t.forEach(a=>{c.renderButton(a,e[a])})})},renderButton:(t,e)=>{e?$('[data-bookmark-add-id="'+t+'"]').each(function(){$(this).attr({style:"color:#FF3347!important;",title:"Удалить из закладок","data-method":"del"})}):$('[data-bookmark-add-id="'+t+'"]').each(function(){$(this).attr({style:"",title:"Добавить в закладки","data-method":"add"})})},add:t=>{g.post("/bookmark/store",{music_id:t}).then(e=>{e.data.success?c.renderButton(t,!0):e.data.error&&alert(e.data.error)})},del:t=>{g.post("/bookmark/destroy",{music_id:t}).then(e=>{e.data.success?c.renderButton(t):e.data.error&&alert(e.data.error)})},getStatus:(t,e)=>{g.get("/bookmark/status",{params:{list:t}}).then(a=>{var r;(r=a==null?void 0:a.data)!=null&&r.success?e(a.data.success):e({})}).catch(()=>{e({})})}};$(c.init);class M{setTabFocus(e){g.post("/web-push/setTabFocus",{focus:e})}}window.MultiRequest=new O;$(()=>{q();const t=new M;I({onStop:()=>{t.setTabFocus(0)},onPause:()=>{t.setTabFocus(0)},onHideTab:()=>{t.setTabFocus(0)},onShowTab:()=>{t.setTabFocus(1)},onPlay:()=>{t.setTabFocus(1)}})});
